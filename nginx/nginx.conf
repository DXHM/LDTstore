# NGINX Config for ldtstore.com.cn Rev 0.3.0
# Copyright 2021 stackinspector. MIT Lincese.

user root;
pcre_jit on;
events {}

error_log logs/error debug;

http {

    # generated from the following argument list string and JavaScript code
    # 'time_iso8601  remote_addr remote_user  request http_referer http_user_agent http_accept http_x_forwarded_for http_cookie
    #   status bytes_sent body_bytes_sent  connection connection_requests'
    # `log_format json_detailed escape=json '{` + args.replace(/  /g, ' ').split(' ').map(arg => `"${arg}":"$${arg}"`).join(`,`) + `}';`
    log_format json_detailed escape=json '{"time_iso8601":"$time_iso8601","remote_addr":"$remote_addr","remote_user":"$remote_user","request":"$request","http_referer":"$http_referer","http_user_agent":"$http_user_agent","http_accept":"$http_accept","http_x_forwarded_for":"$http_x_forwarded_for","http_cookie":"$http_cookie","status":"$status","bytes_sent":"$bytes_sent","body_bytes_sent":"$body_bytes_sent","connection":"$connection","connection_requests":"$connection_requests"}';
    access_log logs/access json_detailed;

    # performance optimizations
    sendfile   on;
    tcp_nopush on;
    gzip       on;

    # ssl certificate files
    ssl_certificate     /root/cert/ldtstore.com.cn.pem;
    ssl_certificate_key /root/cert/ldtstore.com.cn.key;

    # ssl configurations
    ssl_protocols       TLSv1.2 TLSv1.3;
    ssl_ciphers         ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4:!DH:!DHE;
    ssl_session_cache   shared:SSL:10m;

    server {

        # forced redirection from http to https
        listen 80;
        server_name ldtstore.com.cn;
        return 301 https://$server_name$request_uri;

    }

    server {

        listen 443 ssl http2;
        server_name ldtstore.com.cn;

        # hsts support
        add_header Strict-Transport-Security "max-age=31536000; preload" always;

        # files
        root wwwroot;
        index index.html;
        location = /favicon.ico { return 301 /laodi.png; }

        # redirecting routes
        location = /r/home  { return 301 https://space.bilibili.com/178429408/;  }
        location = /r/store { return 301 https://shop294008044.taobao.com/;      }
        location = /r/yjws  { return 301 https://t.bilibili.com/topic/16378017/; }
        location = /r/icu   { return 301 https://t.bilibili.com/topic/19015795/; }

    }

}
